---
pagination:
  data: collections.categories
  size: 1
  alias: category
permalink: "interests/blog/categories/{{ category | slugify }}/index.html"
layout: navigationBar.njk
CSSNesting: ../../../../CSS/
pageName: categories
pageNesting: ../../../../
---
<div id="main">
    <div id="category-links">
      <h2>Category: {{ category }}</h2>
      <p>
        <a id="Back-Button" href="{{ page.pageNesting }}/interests/blog/blog.html">Back to all posts</a>
      </p>
    </div>
    <div id="text-box">
      {% set posts = collections.post | filterByCategory(category) %}
      <ul>
        {%- for post in posts| reverse -%}
            <h2>{{ post.data.title }}</h2>
            <h3>{{ post.date | readableDateTime }}</h3>
            <p>
                {% excerpt post %}
            </p>
            <section id="comments">
              <h2>Comments</h2>
              <div id="comment-list"></div>
              <form id="comment-form">
                  <input name="author" placeholder="Name" required />
                  <textarea name="text" required></textarea>
                  <button type="submit">Post</button>
              </form>
            </section>
            </br>
            <script>
              // TODO Change for production
              const API_BASE = "http://127.0.0.1:5000";
              // const API_BASE = Raspberry Pi IP address/comments
              const postId = window.location.pathname;

              fetch(`${API_BASE}/comments?post=${postId}`)
              .then(r => r.json())
              .then(comments => {
                  document.getElementById("comment-list").innerHTML =
                  comments.map(c => `<p><b>${c.author}</b>: ${c.text}</p>`).join("");
              });

              document.getElementById("comment-form").addEventListener("submit", async e => {
              e.preventDefault();
              const form = e.target;

              await fetch(`${API_BASE}/comments`, {
                  method: "POST",
                  headers: {"Content-Type": "application/json"},
                  body: JSON.stringify({
                  post: postId,
                  author: form.author.value,
                  text: form.text.value
                  })
              });
              location.reload();
              });
            </script>
        {%- endfor -%}
      </ul>
    </div>
</div>